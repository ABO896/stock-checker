<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Stock Checker</title>
	</head>
	<body>
		<form id="stock-form">
			<label for="symbol">Enter Stock Symbol:</label>
			<input
				type="text"
				id="symbol"
				name="symbol"
				required
				autocomplete="off"
			/>
			<button type="submit">Search</button>
		</form>
		<div id="peers">
			<h3>Related Companies</h3>
			<ul id="peers-list"></ul>
		</div>
		<script>
			const form = document.getElementById('stock-form');
			const peersDiv = document.getElementById('peers');
			const peersList = document.getElementById('peers-list');

			form.addEventListener('submit', async (event) => {
				event.preventDefault();
				const symbol = document.getElementById('symbol').value.trim();

				console.log(`Search submitted for symbol: ${symbol}`);

				try {
					// Fetch stock data from server
					const response = await fetch(`/stock?symbol=${symbol}`);
					if (!response.ok) {
						throw new Error('Failed to fetch stock data.');
					}

					const data = await response.json();
					console.log('Response data received:', data);

					// Display peers data
					if (
						data.peers &&
						Array.isArray(data.peers) &&
						data.peers.length > 0
					) {
						const peersHtml = data.peers
							.map((peer) => `<li>${peer}</li>`)
							.join('');
						peersList.innerHTML = peersHtml;
						console.log('Peers list updated:', peersList.innerHTML);
					} else {
						peersList.innerHTML = '<li>No related companies available.</li>';
					}
				} catch (error) {
					console.error('Error fetching stock data:', error);
					peersList.innerHTML = '<li>Error fetching peers data.</li>';
				}
			});
		</script>
	</body>
</html>
